@model NWHarvest.Web.Controllers.ViewLists

@{
    if (Model.registeredUser.Role == "admin")
    {
        ViewBag.TopTitle = "All Available Produce";
        ViewBag.BottomTitle = "No Longer Available and Expired Produce";
    }

    if (Model.registeredUser.Role == "grower")
    {
        ViewBag.TopTitle = "My Available Produce";
        ViewBag.BottomTitle = "My Claimed and Expired Produce";
    }

    if (Model.registeredUser.Role == "foodBank")
    {
        ViewBag.TopTitle = "Available Produce";
        ViewBag.BottomTitle = "My Claimed Produce";
    }
}

<h1>Welcome @Model.registeredUser.UserName!</h1>

<h2>@ViewBag.TopTitle</h2>

<!--Only allow admins and growers to add listings-->
@if (Model.registeredUser.Role == "admin" || Model.registeredUser.Role == "grower")
{
    <p>
        @Html.ActionLink("Create New", "Create")
    </p>
}

@{ var ListingForTitles = Model.TopList.FirstOrDefault(); }

<table class="table" id="TopTable">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.Grower.Id)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.product)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.qtyOffered)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.qtyClaimed)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.qtyLabel)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.expire_date)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.cost)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.available)
            </th>
            <th>
                @Html.DisplayNameFor(model => ListingForTitles.comments)
            </th>
            <th></th>
        </tr>
    </thead>
    @foreach (var item in Model.TopList) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Grower.name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.product)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyOffered)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyClaimed)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyLabel)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.expire_date)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.cost)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.available)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.comments)
            </td>
            <td>
                <!--Add check for if authorized to edit or delete (growers and admins only)-->
                @if (Model.registeredUser.Role == "admin" || Model.registeredUser.Role == "grower")
                {
                    @Html.ActionLink("Edit", "Edit", new { id = item.id })
                    <b>|</b>
                    @Html.ActionLink("Delete", "Delete", new { id = item.id })
                }
                
                <!--Only food banks can claim food.-->
                @if (Model.registeredUser.Role == "foodBank")
                {
                    @Html.ActionLink("Claim", "Claim", new { id = item.id })
                }
                
            </td>
        </tr>
    }
</table>

<h2>@ViewBag.BottomTitle</h2>

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.Grower.Id)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.product)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.qtyOffered)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.qtyClaimed)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.qtyLabel)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.expire_date)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.cost)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.available)
        </th>
        <th>
            @Html.DisplayNameFor(model => ListingForTitles.comments)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model.BottomList)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Grower.name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.product)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyOffered)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyClaimed)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.qtyLabel)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.expire_date)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.cost)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.available)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.comments)
            </td>
        </tr>
    }

</table>

@section Scripts {
    @Scripts.Render("~/bundles/javascript")
    <script type="text/javascript">
        $(document).ready(function () {
            $('#TopTable').DataTable();
        })
    </script>
}